import React, { useState, useEffect } from 'react';
import { HelpCircle, RefreshCw, CheckCircle2, XCircle, Info, BookOpen, MessageCircle, ChevronLeft, CalendarDays, Clock, ArrowRight } from 'lucide-react';

const DAYS_DATA = [
  { 
    nl: 'Maandag', hiragana: 'げつようび', kanji: '月曜日', romaji: 'getsuyoubi',
    meaning: 'Maan', kanjiChar: '月', kanjiName: 'getsu',
    exHira: 'きょうはげつようびです。', exRomaji: 'kyou wa getsuyoubi desu', exNl: 'Vandaag is het maandag.'
  },
  { 
    nl: 'Dinsdag', hiragana: 'かようび', kanji: '火曜日', romaji: 'kayoubi',
    meaning: 'Vuur', kanjiChar: '火', kanjiName: 'ka',
    exHira: 'あしたはかようびです。', exRomaji: 'ashita wa kayoubi desu', exNl: 'Morgen is het dinsdag.'
  },
  { 
    nl: 'Woensdag', hiragana: 'すいようび', kanji: '水曜日', romaji: 'suiyoubi',
    meaning: 'Water', kanjiChar: '水', kanjiName: 'sui',
    exHira: 'きのうはすいようびでした。', exRomaji: 'kinou wa suiyoubi deshita', exNl: 'Gisteren was het woensdag.'
  },
  { 
    nl: 'Donderdag', hiragana: 'もくようび', kanji: '木曜日', romaji: 'mokuyoubi',
    meaning: 'Hout (Boom)', kanjiChar: '木', kanjiName: 'moku',
    exHira: 'もくようびにテストがあります。', exRomaji: 'mokuyoubi ni tesuto ga arimasu', exNl: 'Op donderdag is er een toets.'
  },
  { 
    nl: 'Vrijdag', hiragana: 'きんようび', kanji: '金曜日', romaji: 'kinyoubi',
    meaning: 'Goud (Metaal)', kanjiChar: '金', kanjiName: 'kin',
    exHira: 'らいしゅうはきんようびにはたらきます。', exRomaji: 'raishuu wa kinyoubi ni hatarakimasu', exNl: 'Volgende week werk ik op vrijdag.'
  },
  { 
    nl: 'Zaterdag', hiragana: 'どようび', kanji: '土曜日', romaji: 'doyoubi',
    meaning: 'Aarde (Grond)', kanjiChar: '土', kanjiName: 'do',
    exHira: 'どようびはやすみです。', exRomaji: 'doyoubi wa yasumi desu', exNl: 'Zaterdag is een vrije dag.'
  },
  { 
    nl: 'Zondag', hiragana: 'にちようび', kanji: '日曜日', romaji: 'nichiyoubi',
    meaning: 'Zon', kanjiChar: '日', kanjiName: 'nichi',
    exHira: 'にちようびにこうえんにいきます。', exRomaji: 'nichiyoubi ni kouen ni ikimasu', exNl: 'Op zondag ga ik naar het park.'
  },
];

const TIME_WORDS_DATA = [
  { 
    nl: 'Gisteren', hiragana: 'きのう', kanji: '昨日', romaji: 'kinou',
    exHira: 'きのうはにちようびでした。', exRomaji: 'kinou wa nichiyoubi deshita', exNl: 'Gisteren was het zondag.' 
  },
  { 
    nl: 'Vandaag', hiragana: 'きょう', kanji: '今日', romaji: 'kyou',
    exHira: 'きょうはとてもあついです。', exRomaji: 'kyou wa totemo atsui desu', exNl: 'Vandaag is het erg warm.' 
  },
  { 
    nl: 'Morgen', hiragana: 'あした', kanji: '明日', romaji: 'ashita',
    exHira: 'あしたはともだちにあいます。', exRomaji: 'ashita wa tomodachi ni aimasu', exNl: 'Morgen ontmoet ik een vriend.' 
  },
  { 
    nl: 'Vorige week', hiragana: 'せんしゅう', kanji: '先週', romaji: 'senshuu',
    exHira: 'せんしゅうはテストがありました。', exRomaji: 'senshuu wa tesuto ga arimashita', exNl: 'Vorige week was er een toets.' 
  },
  { 
    nl: 'Deze week', hiragana: 'こんしゅう', kanji: '今週', romaji: 'konshuu',
    exHira: 'こんしゅうはいそがしいです。', exRomaji: 'konshuu wa isogashii desu', exNl: 'Deze week ben ik druk.' 
  },
  { 
    nl: 'Volgende week', hiragana: 'らいしゅう', kanji: '来週', romaji: 'raishuu',
    exHira: 'らいしゅうはやすみです。', exRomaji: 'raishuu wa yasumi desu', exNl: 'Volgende week ben ik vrij.' 
  },
  { 
    nl: 'Vorige maand', hiragana: 'せんげつ', kanji: '先月', romaji: 'sengetsu',
    exHira: 'せんげつはにほんにいきました。', exRomaji: 'sengetsu wa nihon ni ikimashita', exNl: 'Vorige maand ben ik naar Japan gegaan.' 
  },
  { 
    nl: 'Deze maand', hiragana: 'こんげつ', kanji: '今月', romaji: 'kongetsu',
    exHira: 'こんげつはたんじょうびです。', exRomaji: 'kongetsu wa tanjoubi desu', exNl: 'Deze maand is mijn verjaardag.' 
  },
  { 
    nl: 'Volgende maand', hiragana: 'らいげつ', kanji: '来月', romaji: 'raigetsu',
    exHira: 'らいげつはテストがあります。', exRomaji: 'raigetsu wa tesuto ga arimasu', exNl: 'Volgende maand is er een toets.' 
  },
  { 
    nl: 'Vorig jaar', hiragana: 'きょねん', kanji: '去年', romaji: 'kyonen',
    exHira: 'きょねん、ちゅうがくせいになりました。', exRomaji: 'kyonen, chuugakusei ni narimashita', exNl: 'Vorig jaar werd ik een middelbare scholier.' 
  },
  { 
    nl: 'Dit jaar', hiragana: 'ことし', kanji: '今年', romaji: 'kotoshi',
    exHira: 'ことしはがんばります。', exRomaji: 'kotoshi wa ganbarimasu', exNl: 'Dit jaar ga ik mijn best doen.' 
  },
  { 
    nl: 'Volgend jaar', hiragana: 'らいねん', kanji: '来年', romaji: 'rainen',
    exHira: 'らいねんはじゅうごさいです。', exRomaji: 'rainen wa juugo-sai desu', exNl: 'Volgend jaar ben ik vijftien jaar oud.' 
  },
];

const SENTENCES_DATA = [
  { nl: 'Wat voor dag is het vandaag?', hiragana: 'きょうはなんようびですか。', kanji: '今日は何曜日ですか。', romaji: 'kyou wa nan-youbi desu ka?' },
  { nl: 'Vandaag is het maandag.', hiragana: 'きょうはげつようびです。', kanji: '今日は月曜日です。', romaji: 'kyou wa getsuyoubi desu.' },
  { nl: 'Morgen is het dinsdag.', hiragana: 'あしたはかようびです。', kanji: '明日は火曜日です。', romaji: 'ashita wa kayoubi desu.' },
  { nl: 'Gisteren was het zondag.', hiragana: 'きのうはにちようびでした。', kanji: '昨日は日曜日でした。', romaji: 'kinou wa nichiyoubi deshita.' },
  { nl: 'Volgende week is het vrijdag.', hiragana: 'らいしゅうはきんようびです。', kanji: '来週は金曜日です。', romaji: 'raishuu wa kinyoubi desu.' },
  { nl: 'Vorig jaar was het 2025.', hiragana: 'きょねんはにせんじゅうごねんでした。', kanji: '去年は2025年でした。', romaji: 'kyonen wa nisen-juugo-nen deshita.' },
  { nl: 'Volgende maand is het mei.', hiragana: 'らいげつはごがつです。', kanji: '来月は五月です。', romaji: 'raigetsu wa go-gatsu desu.' },
];

const App = () => {
  const [mode, setMode] = useState('menu');
  const [currentStep, setCurrentStep] = useState(0);
  const [score, setScore] = useState(0);
  const [showResult, setShowResult] = useState(false);
  const [options, setOptions] = useState([]);
  const [selectedAnswer, setSelectedAnswer] = useState(null);
  const [isCorrect, setIsCorrect] = useState(null);
  const [showRomaji, setShowRomaji] = useState(false);
  const [quizItems, setQuizItems] = useState([]);

  const getDataSet = (m) => {
    switch(m) {
      case 'vocab': return DAYS_DATA;
      case 'time': return TIME_WORDS_DATA;
      case 'sentences': return SENTENCES_DATA;
      default: return [];
    }
  };

  const startQuiz = (selectedMode) => {
    const data = getDataSet(selectedMode);
    const shuffled = [...data].sort(() => Math.random() - 0.5);
    setQuizItems(shuffled);
    setMode(selectedMode);
    setCurrentStep(0);
    setScore(0);
    setShowResult(false);
    setSelectedAnswer(null);
    setIsCorrect(null);
    setShowRomaji(false);
    generateOptions(shuffled[0], data);
  };

  const generateOptions = (correctItem, fullSet) => {
    const others = fullSet.filter(d => d.hiragana !== correctItem.hiragana)
      .sort(() => Math.random() - 0.5)
      .slice(0, 3);
    const newOptions = [...others, correctItem].sort(() => Math.random() - 0.5);
    setOptions(newOptions);
  };

  const handleAnswer = (option) => {
    if (selectedAnswer !== null) return;
    
    const correct = option.hiragana === quizItems[currentStep].hiragana;
    setSelectedAnswer(option.hiragana);
    setIsCorrect(correct);
    if (correct) setScore(score + 1);

    if (!correct) {
      setTimeout(nextQuestion, 1500);
    }
    else if (mode === 'sentences') {
      setTimeout(nextQuestion, 1200);
    }
  };

  const nextQuestion = () => {
    if (currentStep < quizItems.length - 1) {
      const nextStep = currentStep + 1;
      setCurrentStep(nextStep);
      setSelectedAnswer(null);
      setIsCorrect(null);
      setShowRomaji(false);
      generateOptions(quizItems[nextStep], getDataSet(mode));
    } else {
      setShowResult(true);
    }
  };

  const goToMenu = () => {
    setMode('menu');
  };

  if (mode === 'menu') {
    return (
      <div className="min-h-screen bg-slate-50 flex flex-col items-center justify-center p-6 font-sans text-slate-900">
        <div className="max-w-md w-full bg-white rounded-3xl shadow-xl p-8 border border-slate-100 text-center">
          <div className="w-20 h-20 bg-indigo-100 text-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-6 transform rotate-3">
            <Clock size={40} />
          </div>
          <h1 className="text-2xl font-black text-slate-800 mb-2 uppercase tracking-tight">Japanese From Zero</h1>
          <h2 className="text-xl font-bold text-indigo-600 mb-6 italic">Les 9</h2>
          <p className="text-slate-500 mb-8 text-sm">Oefen de Japanse tijdsaanduidingen:</p>
          
          <div className="space-y-3">
            <button 
              onClick={() => startQuiz('vocab')}
              className="w-full flex items-center gap-4 p-4 rounded-2xl border-2 border-slate-100 hover:border-indigo-500 hover:bg-indigo-50 transition-all text-left group"
            >
              <div className="bg-indigo-600 text-white p-3 rounded-xl group-hover:scale-110 transition-transform shadow-md">
                <CalendarDays size={20} />
              </div>
              <div>
                <div className="font-bold">De Dagen</div>
                <div className="text-[10px] text-slate-400 uppercase font-bold tracking-tight">Maandag t/m Zondag</div>
              </div>
            </button>

            <button 
              onClick={() => startQuiz('time')}
              className="w-full flex items-center gap-4 p-4 rounded-2xl border-2 border-slate-100 hover:border-amber-500 hover:bg-amber-50 transition-all text-left group"
            >
              <div className="bg-amber-600 text-white p-3 rounded-xl group-hover:scale-110 transition-transform shadow-md">
                <Clock size={20} />
              </div>
              <div>
                <div className="font-bold text-sm sm:text-base text-balance leading-tight">Gisteren, vandaag en meer</div>
                <div className="text-[10px] text-slate-400 uppercase font-bold tracking-tight">Week, maand en jaar</div>
              </div>
            </button>

            <button 
              onClick={() => startQuiz('sentences')}
              className="w-full flex items-center gap-4 p-4 rounded-2xl border-2 border-slate-100 hover:border-emerald-500 hover:bg-emerald-50 transition-all text-left group"
            >
              <div className="bg-emerald-600 text-white p-3 rounded-xl group-hover:scale-110 transition-transform shadow-md">
                <MessageCircle size={20} />
              </div>
              <div>
                <div className="font-bold">Eenvoudige Zinnen</div>
                <div className="text-[10px] text-slate-400 uppercase font-bold tracking-tight">Vragen en antwoorden</div>
              </div>
            </button>
          </div>
        </div>
      </div>
    );
  }

  const currentItem = quizItems[currentStep];
  const headerColors = {
    vocab: 'bg-indigo-600',
    time: 'bg-amber-600',
    sentences: 'bg-emerald-600'
  };

  return (
    <div className="min-h-screen bg-slate-50 flex flex-col items-center p-4 sm:p-8 font-sans text-slate-900">
      <div className="max-w-2xl w-full bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-100 relative">
        
        <div className={`p-6 text-white text-center relative ${headerColors[mode]}`}>
          <button 
            onClick={goToMenu}
            className="absolute left-6 top-1/2 -translate-y-1/2 p-2 hover:bg-white/20 rounded-full transition-colors"
          >
            <ChevronLeft size={24} />
          </button>
          <div className="flex flex-col">
            <span className="text-[10px] uppercase font-bold opacity-80 tracking-widest">Japanese From Zero - Les 9</span>
            <h1 className="text-lg font-bold">
              {mode === 'vocab' ? 'Dagen' : mode === 'time' ? 'Tijdswoorden' : 'Zinnen'}
            </h1>
          </div>
          <div className="flex justify-center gap-4 text-[10px] mt-2 opacity-90">
            <span className="bg-black/10 px-3 py-1 rounded-full uppercase font-bold tracking-widest">
              {currentStep + 1} / {quizItems.length}
            </span>
            <span className="bg-black/10 px-3 py-1 rounded-full uppercase font-bold tracking-widest">
              Score: {score}
            </span>
          </div>
        </div>

        {!showResult ? (
          <div className="p-8">
            <div className="text-center mb-10">
              <p className="text-slate-400 uppercase tracking-widest text-[10px] font-black mb-2">Vertaal</p>
              <h2 className="text-3xl font-black text-slate-800 leading-tight text-balance">
                "{currentItem?.nl}"
              </h2>
            </div>

            <div className="grid grid-cols-1 gap-4 mb-8">
              {options.map((option, idx) => (
                <button
                  key={idx}
                  onClick={() => handleAnswer(option)}
                  disabled={selectedAnswer !== null}
                  className={`
                    p-5 rounded-2xl transition-all duration-200 border-2 flex flex-col items-center justify-center gap-1
                    ${selectedAnswer === null ? 'hover:border-indigo-400 hover:bg-indigo-50 border-slate-100 bg-white shadow-sm' : ''}
                    ${selectedAnswer === option.hiragana && isCorrect ? 'bg-emerald-50 border-emerald-500 text-emerald-700 shadow-md scale-[1.01]' : ''}
                    ${selectedAnswer === option.hiragana && !isCorrect ? 'bg-rose-50 border-rose-500 text-rose-700 shadow-md' : ''}
                    ${selectedAnswer !== null && option.hiragana === currentItem.hiragana && !isCorrect ? 'bg-emerald-50 border-emerald-500 text-emerald-700 shadow-sm' : ''}
                    ${selectedAnswer !== null && selectedAnswer !== option.hiragana && option.hiragana !== currentItem.hiragana ? 'opacity-30 grayscale cursor-default' : ''}
                  `}
                >
                  <span className={`tracking-wider ${mode === 'sentences' ? 'text-lg text-center leading-snug text-balance' : 'text-2xl font-bold'}`}>
                    {option.hiragana}
                  </span>
                  <span className="text-sm text-slate-500 opacity-80">{option.kanji}</span>
                  {showRomaji && (
                    <span className="text-xs font-mono text-indigo-500 mt-2 uppercase tracking-tighter bg-indigo-50 px-2 py-0.5 rounded italic font-bold">
                      {option.romaji}
                    </span>
                  )}
                </button>
              ))}
            </div>

            {selectedAnswer !== null && isCorrect && mode !== 'sentences' && (
              <div className="mb-8 p-6 bg-slate-50 border-2 border-indigo-100 rounded-3xl animate-in fade-in zoom-in duration-300">
                <div className="flex justify-between items-start mb-4">
                  <div className="flex flex-col gap-1 w-full text-left">
                    <p className="text-[10px] uppercase font-black text-indigo-400 tracking-widest mb-1">Oplossing</p>
                    
                    <div className="flex flex-wrap items-baseline gap-x-4 mb-1">
                      <span className="text-3xl font-bold text-indigo-900 leading-none">{currentItem.kanji}</span>
                      <span className="text-3xl font-medium text-indigo-700 leading-none">{currentItem.hiragana}</span>
                    </div>
                    
                    <p className="text-sm font-bold text-indigo-400 italic">({currentItem.romaji})</p>
                  </div>
                  <div className="bg-emerald-500 text-white p-2 rounded-full shadow-lg shrink-0">
                    <CheckCircle2 size={24} />
                  </div>
                </div>

                <div className="h-px bg-indigo-100 w-full mb-4"></div>

                {currentItem.meaning && (
                  <div className="mb-4 p-4 bg-indigo-50 rounded-2xl border border-indigo-100">
                    <p className="text-[10px] uppercase font-black text-indigo-400 tracking-widest mb-2">Betekenis</p>
                    <p className="text-sm font-bold text-slate-700 leading-relaxed">
                      <span className="text-indigo-600 font-mono">{currentItem.kanjiName}</span> is <span className="underline decoration-indigo-300 underline-offset-4">{currentItem.meaning}</span>
                      <span className="text-2xl ml-3 font-serif bg-white px-2 py-1 rounded-lg shadow-sm border border-indigo-100 leading-none inline-block align-middle">{currentItem.kanjiChar}</span>
                    </p>
                  </div>
                )}

                <p className="text-[10px] uppercase font-black text-slate-400 tracking-widest mb-2">Voorbeeldzin</p>
                <div className="space-y-1">
                  <div className="text-lg font-bold text-slate-800 leading-tight">{currentItem.exHira}</div>
                  <div className="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3">
                    <span className="text-xs font-mono text-indigo-500 italic bg-white px-2 py-0.5 rounded border border-indigo-100 w-fit">
                      {currentItem.exRomaji}
                    </span>
                    <span className="text-sm font-semibold text-slate-500 leading-tight">
                      = {currentItem.exNl}
                    </span>
                  </div>
                </div>

                <button 
                  onClick={nextQuestion}
                  className="mt-6 w-full bg-indigo-600 text-white py-4 rounded-2xl font-black flex items-center justify-center gap-2 hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-100 active:scale-95"
                >
                  Volgende <ArrowRight size={20} />
                </button>
              </div>
            )}

            {!isCorrect && (
               <div className="flex justify-center">
               <button
                 onClick={() => setShowRomaji(!showRomaji)}
                 className="flex items-center gap-2 px-6 py-3 text-slate-500 hover:text-indigo-600 transition-colors text-xs font-black rounded-xl hover:bg-slate-100 border border-transparent active:scale-95 uppercase tracking-widest"
               >
                 <HelpCircle size={16} />
                 {showRomaji ? 'Verberg romaji' : 'Spiekknop'}
               </button>
             </div>
            )}

            <div className="h-12 mt-4 flex items-center justify-center">
              {isCorrect === true && mode === 'sentences' && (
                <div className="flex items-center gap-2 text-emerald-600 font-black animate-bounce">
                  <CheckCircle2 size={24} /> Goed gedaan!
                </div>
              )}
              {isCorrect === false && (
                <div className="flex items-center gap-2 text-rose-600 font-black animate-shake">
                  <XCircle size={24} /> Probeer het nog eens!
                </div>
              )}
            </div>
          </div>
        ) : (
          <div className="p-10 text-center">
            <div className="w-20 h-20 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-6">
              <CheckCircle2 size={40} />
            </div>
            <h2 className="text-3xl font-black mb-2 text-slate-800 text-center text-balance leading-tight">Gefeliciteerd!</h2>
            <p className="text-slate-500 mb-8 text-lg text-center text-balance leading-tight">
              Je hebt <span className="font-black text-indigo-600">{score}</span> van de {quizItems.length} vragen goed beantwoord.
            </p>
            
            <div className="bg-slate-50 rounded-3xl p-6 mb-8 text-left border border-slate-100">
              <h3 className="font-black mb-4 flex items-center gap-2 text-slate-400 uppercase tracking-widest text-[10px]">
                <Info size={14}/> Overzicht
              </h3>
              <div className="space-y-3 max-h-60 overflow-y-auto pr-2 custom-scrollbar">
                {quizItems.map((d, i) => (
                  <div key={i} className="flex justify-between items-start border-b border-slate-200 pb-2 last:border-0">
                    <div className="text-xs font-bold text-slate-500 uppercase w-32 pr-2 leading-tight">{d.nl}</div>
                    <div className="flex flex-col items-end">
                      <span className="font-bold text-slate-800 text-sm leading-none mb-1">{d.hiragana}</span>
                      <span className="text-xs text-slate-600 font-medium mb-1">{d.kanji}</span>
                      <span className="text-[10px] text-slate-400 italic leading-none">{d.romaji}</span>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            <div className="flex flex-col gap-3">
              <button
                onClick={() => startQuiz(mode)}
                className={`w-full py-4 px-6 rounded-2xl font-black text-white transition-all flex items-center justify-center gap-2 shadow-lg ${headerColors[mode]}`}
              >
                <RefreshCw size={20} /> Opnieuw proberen
              </button>
              <button
                onClick={goToMenu}
                className="w-full py-4 px-6 rounded-2xl font-bold text-slate-400 hover:bg-slate-100 transition-all flex items-center justify-center gap-2"
              >
                Terug naar het menu
              </button>
            </div>
          </div>
        )}

        {!showResult && (
          <div className="h-1 bg-slate-100 w-full overflow-hidden text-balance">
            <div 
              className={`h-full transition-all duration-700 ${headerColors[mode]}`}
              style={{ width: `${((currentStep) / quizItems.length) * 100}%` }}
            ></div>
          </div>
        )}
      </div>

      <style>{`
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-6px); }
          75% { transform: translateX(6px); }
        }
        .animate-shake { animation: shake 0.15s ease-in-out; animation-iteration-count: 3; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
      `}</style>
    </div>
  );
};

export default App;